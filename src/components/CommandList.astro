---
/**
 * 命令列表展示组件
 */
import { Icon } from '@astrojs/starlight/components'
import { getCommandCategories, getCommandsByCategory, getPlatformIcon } from '../utils/loadCommands'

// 在组件顶层获取数据
const categories = await getCommandCategories();
const allCommands = new Map();

for (const category of categories) {
  const commands = await getCommandsByCategory(category.path);
  allCommands.set(category.path, commands);
}

interface Props {
  title?: string
}

const { title = '命令分类' } = Astro.props;
---

<section class="commands-section">
  <h2><Icon name="box" size="1.2em" /> {title}</h2>

  {categories.map((category) => (
    <div class="category-section" id={category.path.replace('.json', '')}>
      <div class="category-header">
        <h3><Icon name="folder" size="1.2em" /> {category.name_zh}</h3>
      </div>

      <div class="commands-grid">
        {allCommands.get(category.path).map((cmd) => (
          <div class="command-card">
            <div class="command-header">
              <h4>{cmd.name_zh}</h4>
              <span class="platform-icon" title={`平台: ${cmd.platform}`}>
                {getPlatformIcon(cmd.platform)}
              </span>
            </div>

            <p class="command-description">{cmd.description_zh}</p>

            <div class="command-details">
              <div class="command-name-en">
                <Icon name="globe" size="1em" />
                <strong>{cmd.name_en}</strong>
              </div>
              <p class="command-description-en">{cmd.description_en}</p>
            </div>

            <div class="command-code">
              <code>
                <Icon name="terminal" size="0.9em" />
                {cmd.command}
              </code>
            </div>
          </div>
        ))}
      </div>
    </div>
  ))}
</section>

<style>
  .commands-section {
    margin-top: 2rem;
  }

  .category-section {
    margin-top: 3rem;
    margin-bottom: 2rem;
  }

  .category-header {
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--sl-color-accent);
  }

  .category-header h3 {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0;
    color: var(--sl-color-text-accent);
  }

  .commands-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
  }

  .command-card {
    padding: 1.5rem;
    border: 1px solid var(--sl-color-gray-3);
    border-radius: var(--sl-border-radius-medium);
    background: var(--sl-color-bg-accent);
    transition: all 0.3s ease;
  }

  .command-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--sl-shadow-md);
    border-color: var(--sl-color-accent);
  }

  .command-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .command-header h4 {
    margin: 0;
    font-size: 1.25rem;
    color: var(--sl-color-text-accent);
  }

  .platform-icon {
    font-size: 1.5rem;
    padding: 0.25rem 0.5rem;
    background: var(--sl-color-gray-3);
    border-radius: var(--sl-border-radius-small);
  }

  .command-description {
    color: var(--sl-color-text-secondary);
    margin-bottom: 1rem;
    line-height: 1.6;
  }

  .command-details {
    margin-bottom: 1rem;
    padding: 1rem;
    background: var(--sl-color-gray-2);
    border-radius: var(--sl-border-radius-small);
  }

  .command-name-en {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    color: var(--sl-color-text-accent);
  }

  .command-description-en {
    margin: 0;
    font-size: 0.9rem;
    color: var(--sl-color-text-secondary);
    font-style: italic;
  }

  .command-code {
    margin-top: 1rem;
  }

  .command-code code {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: var(--sl-color-gray-1);
    border: 1px solid var(--sl-color-gray-3);
    border-radius: var(--sl-border-radius-small);
    font-family: var(--sl-font-mono);
    font-size: 0.875rem;
    color: var(--sl-color-code-base);
    overflow-x: auto;
  }

  @media (max-width: 768px) {
    .commands-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
